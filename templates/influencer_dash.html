<!DOCTYPE html>
<html lang="en">

<head>

  <title>Influencer Dashboard</title>
  <link rel="stylesheet" href="../static/dashboard.css">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">

</head>

<body>
  <div id="main">
    <div id="canvas">
      <div id="dashboard-body">
        <!-- nav bar for influencer dashboard -->
        <nav class="navbar navbar-expand-lg navbar-light bg-light">
          <div class="container-fluid">
            <label style="margin-right: 15px;">Welcome {{influencer.user_name}}</label>
            <!--<a class="navbar-brand" href="#">My Dashboard</a>-->
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
              data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false"
              aria-label="Toggle navigation">
              <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarSupportedContent">
              <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                <li class="nav-item">
                  <button type="button" class="btn btn-outline-info" style=" margin-right: 10px;"
                    onclick="location.href='/influencer/update/{{ influencer.id }}'"> Update Profile </button>
                </li>
              </ul>
              <form class="d-flex" style="margin-right: 10px;" action="/search">
                <input class="form-control me-2" type="search" placeholder="Search Campaign" aria-label="Search" name="srch_word">
                <button class="btn btn-outline-success" type="submit">Search</button>
              </form>
              <form class="d-flex">
                <button class="btn btn-outline-danger" type="button"
                  onclick="location.href= '/userlogin'">Logout</button>
              </form>

            </div>
          </div>
        </nav><br>
        <!--profile pic-->
        <div style="display: flex; align-items: center;">
          <img src="/static/picture.png" alt="profile pic" width="200px">
          <div style="margin-left: 20px;">
            <p>I am {{ influencer.full_name }}</p>
            <p>My current following is {{ influencer.followers }}</p>
            <p>My niche is {{ influencer.niche }}</p>
            <p>Active on {{ influencer.platform }}</p>
          </div>
        </div><br>

        <!-- New Ad Requests -->
        <h5>New Ad Requests</h5>
        <div class="container mt-4">
          {% if ad_requests|selectattr('status', 'equalto', 'pending')|list|length == 0 %}
          <p style="color:lawngreen"><b><i> Ooops !! Currently no ad requests for you :(</i></b></p>
          {% else %}
          <table class="table table-bordered table-striped">
            <thead>
              <tr style="text-align: center;">
                <th scope="col">S.No.</th>
                <th scope="col">Campaign</th>
                <th scope="col">Requirements</th>
                <th scope="col">Payment Amount</th>
                <th scope="col">Status</th>
                <th scope="col">End_date</th>
                <th scope="col">Action</th>
              </tr>
            </thead>
            <tbody style="text-align: center;">
              {% for req in ad_requests %}
              {% if req.status == 'pending' %}
              <tr>
                <th scope="row">{{ loop.index }}</th>
                <td>{{ req.campaign.camp_name }}</td>
                <td>{{ req.requirements }}</td>
                <td>{{ req.payment_amt }}</td>
                <td>{{ req.status }}</td>
                <td>{{ req.end_date }}</td>
                <td>
                  <div id="button-container">
                    <form action='/influencer/accept/{{ influencer.id }}/ad_request/{{ req.request_id }}' method="post">
                      <button type="submit" class="btn btn-success"
                        style="margin-left:20px; margin-right: 20px;">Accept</button>
                    </form>
                    <form action='/influencer/{{ influencer.id }}/reject_ad_request/{{ req.request_id }}' method="POST"
                      onsubmit="return confirm('Are you sure you want to reject this ad_request?');">
                      <input type="hidden" name="_method" value="REJECT">
                      <button type="submit" class="btn btn-danger">Reject</button>
                    </form>
                  </div>
                </td>
              </tr>
              {% endif %}
              {% endfor %}
            </tbody>
          </table>
          {% endif %}
        </div>


        <!--Influencer's current or active campaigns-->
        <h5>My Engagements</h5>
        <div class="container mt-4">
          {% set active_requests = ad_requests|selectattr('status', 'equalto', 'accepted')|list %}
          {% if active_requests|length > 0 %}
          <table class="table table-bordered table-striped">
            <thead>
              <tr style="text-align: center;">
                <th scope="col">S.No.</th>
                <th scope="col">Campaign</th>
                <th scope="col">To do</th>
                <th scope="col">Status</th>
                <th scope="col">Expires</th>
              </tr>
            </thead>
            <tbody style="text-align: center;">
              {% for req in active_requests %}
              <tr>
                <th scope="row">{{ loop.index }}</th>
                <td>{{ req.campaign.camp_name }}</td>
                <td>{{ req.requirements }}</td>
                <td>active</td>
                <td>{{ req.end_date }}</td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
          {% else %}
          <p style="color: crimson;"><b><i> You seem to be enjoying your ideal time &#x1F601;</i></b></p>
          {% endif %}
        </div>

      </div>
    </div>
  </div>

</body>

</html>